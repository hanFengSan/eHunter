# Feature Specification: 书页模式翻页动效开关

**Feature Branch**: `001-add-pageflip-toggle`  
**Created**: 2026-02-18  
**Status**: Draft  
**Input**: User description: "我需要给书页模式支持拟真翻页，且新增一个开关：翻页动效，默认为拟真翻页，其他选项：平移翻页、无动效"

## Clarifications

### Session 2026-02-18

- Q: 翻页动效设置的生效范围应如何定义？ → A: 全局设置（对所有书页模式画集统一生效）。

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 拟真翻页阅读 (Priority: P1)

作为书页模式读者，我希望翻到下一页或上一页时出现拟真翻页效果，以获得更贴近纸质书的沉浸式阅读体验。

**Why this priority**: 用户明确提出“拟真翻页”且要求默认启用，这是本需求的核心价值。

**Independent Test**: 在书页模式打开任意画集，保持翻页动效为默认值，连续执行前后翻页，确认每次翻页均展示拟真翻页效果且内容切换正确。

**Acceptance Scenarios**:

1. **Given** 用户处于书页模式且未修改翻页动效设置，**When** 用户执行翻到下一页，**Then** 页面以拟真翻页方式过渡并进入下一页内容。
2. **Given** 用户处于书页模式且未修改翻页动效设置，**When** 用户执行翻到上一页，**Then** 页面以拟真翻页方式过渡并返回上一页内容。

---

### User Story 2 - 动效模式切换 (Priority: P2)

作为书页模式读者，我希望可在“拟真翻页 / 平移翻页 / 无动效”之间切换，以匹配我的阅读偏好与设备性能。

**Why this priority**: 用户明确要求新增开关并提供三个选项，属于可配置能力的核心范围。

**Independent Test**: 在书页模式设置中依次切换三个选项并翻页，验证各选项触发的翻页表现与设置值一致。

**Acceptance Scenarios**:

1. **Given** 用户处于书页模式设置界面，**When** 用户将翻页动效切换为“平移翻页”，**Then** 后续翻页以平移过渡方式展示。
2. **Given** 用户处于书页模式设置界面，**When** 用户将翻页动效切换为“无动效”，**Then** 后续翻页直接切换内容且无视觉过渡动画。
3. **Given** 用户已将翻页动效改为“平移翻页”或“无动效”，**When** 用户重新选择“拟真翻页”，**Then** 后续翻页恢复为拟真翻页效果。

---

### User Story 3 - 设置持续生效 (Priority: P3)

作为回访读者，我希望我上次选择的翻页动效能被记住，这样不需要每次重新设置。

**Why this priority**: 配置持续性影响日常使用效率，属于增强体验但不阻断核心功能。

**Independent Test**: 用户修改翻页动效后离开并重新进入阅读页，验证翻页行为仍使用上次选择的动效类型。

**Acceptance Scenarios**:

1. **Given** 用户已在书页模式选择任一翻页动效，**When** 用户退出并再次进入同一阅读流程，**Then** 翻页动效保持为上次选择值并立即生效。

---

### Edge Cases

- 当用户在翻页过渡尚未结束时再次触发翻页，系统仅应执行一次有效页码变更并保持动效结果可预期。
- 当用户位于第一页执行“上一页”或位于最后一页执行“下一页”时，不应出现越界翻页或错误提示循环。
- 当阅读内容尚未完成加载时触发翻页，系统应保持交互反馈一致，避免出现空白页长时间停留。
- 当设置值异常或缺失时，系统应自动回退到“拟真翻页”作为默认动效。

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: 系统 MUST 在书页模式中提供三种翻页动效选项：拟真翻页、平移翻页、无动效。
- **FR-002**: 系统 MUST 将“拟真翻页”设为翻页动效的默认选项。
- **FR-003**: 用户 MUST be able to 在书页模式设置中随时切换翻页动效选项。
- **FR-004**: 系统 MUST 在用户切换动效后，从下一次翻页开始按所选动效执行。
- **FR-005**: 系统 MUST 在用户选择“无动效”时以无过渡方式直接完成页面切换。
- **FR-006**: 系统 MUST 记住用户最近一次选择的翻页动效，并在后续阅读会话中继续使用。
- **FR-009**: 系统 MUST 将翻页动效设置作为全局阅读偏好，对所有书页模式画集统一生效。
- **FR-007**: 系统 MUST 在设置值不可用或无效时回退到默认“拟真翻页”。
- **FR-008**: 系统 MUST 将本功能范围限定在书页模式，不改变卷轴模式的翻页/滚动行为。

### Key Entities *(include if feature involves data)*

- **翻页动效设置 (Page Turn Animation Preference)**: 表示用户在书页模式中选择的翻页动效类型，允许值为“拟真翻页 / 平移翻页 / 无动效”，包含默认值与当前生效值。
- **书页翻页动作 (Book Page Turn Action)**: 表示用户触发的上一页/下一页阅读动作，关联当前页、目标页及对应动效表现。
- **阅读会话 (Reading Session)**: 表示一次进入阅读流程的使用周期，用于验证动效设置在离开并重新进入后仍可持续生效。

### Assumptions

- 本需求仅针对书页模式，不扩展到卷轴模式、缩略图浏览或其他阅读视图。
- 三种动效均对“上一页”和“下一页”方向生效，行为规则保持一致。
- 新增开关入口位于现有书页模式相关设置区域，避免引入新的独立设置层级。
- 翻页动效设置为全局偏好，不按画集、站点或会话单独拆分。

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 100% 的书页模式新会话在未手动修改设置时默认使用“拟真翻页”。
- **SC-002**: 在验收测试中，三种动效选项的切换后首个翻页动作表现与所选项一致，成功率达到 100%。
- **SC-003**: 至少 95% 的测试用户可在 10 秒内找到并完成翻页动效切换操作。
- **SC-004**: 至少 95% 的测试场景中，用户离开并重新进入阅读后，翻页动效仍保持为上次选择值。
