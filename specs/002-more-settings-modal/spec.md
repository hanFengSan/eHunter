# Feature Specification: 统一更多设置弹窗

**Feature Branch**: `001-more-settings-modal`  
**Created**: 2026-02-18  
**Status**: Draft  
**Input**: User description: "增加一个“更多设置”的弹窗页面，需要：1) 参考 github、清除缓存按钮实现，增加“更多设置”图标并点击打开弹窗；2) 弹窗采用 iOS 设置风格左右两列，左侧用于快速滚动到右侧分类；3) 左侧分类：通用、滚动模式、书页模式、快捷设置、其他；4) 通用包含语言、加载页数、自动换源重试；5) 滚动模式包含页面比例、分卷页数、缩略图栏等；6) 书页模式包含同屏页数、阅读方向、翻页动效、页目录等；7) 快捷设置可配置顶部快捷栏展示项，阅读模式固定第一位不可修改，其余可拖拽排序，模式特有项仅在对应模式显示；8) 其他包含清空缓存、github 链接、版本号；9) 作为统一配置入口且需覆盖现有设计中的配置项；10) 样式布局简洁美观。"

## Clarifications

### Session 2026-02-18

- Q: “不能有遗漏”的覆盖范围是否包含旧二层更多设置中的高级项？以及是否保留原二层“更多设置”？ → A: 覆盖当前全部已有可配置项（包含旧二层更多设置中的高级项），并删除原先二层“更多设置”。
- Q: “清空缓存”在统一设置弹窗中的作用范围是什么？ → A: 清空缓存并重置全部设置。
- Q: 左侧分类点击后的定位交互应采用哪种方式？ → A: 平滑滚动到对应分组并高亮当前分类，不自动折叠其他分组。
- Q: 快捷设置拖拽排序的持久化范围是什么？ → A: 使用全局一份排序，模式专属项仅在对应模式显示。
- Q: 执行“清空缓存并重置全部设置”是否需要二次确认？ → A: 需要二次确认后执行，并明确提示将重置全部设置。

## User Scenarios & Testing *(mandatory)*

**Validation Note**: For each completed development cycle, run `npm run dev` and verify changed behavior in browser using `chrome-devtools-mcp` before marking work complete.

### User Story 1 - 打开并使用统一设置入口 (Priority: P1)

作为阅读器用户，我希望在顶栏通过一个“更多设置”图标打开统一配置弹窗，以便在一个页面里集中查看和调整阅读相关设置。

**Why this priority**: 统一入口是本需求的核心目标；没有入口和弹窗，后续配置整合无法成立。

**Independent Test**: 在阅读器中点击新增图标，验证弹窗可打开/关闭，且左侧分类点击后可滚动定位到右侧对应配置分组。

**Acceptance Scenarios**:

1. **Given** 用户已进入阅读器且顶栏可见，**When** 用户点击“更多设置”图标，**Then** 系统打开统一设置弹窗并展示左右两列布局。
2. **Given** 统一设置弹窗已打开，**When** 用户点击左侧任一分类，**Then** 右侧内容滚动到该分类对应的配置区域并保持当前分类高亮状态。
3. **Given** 弹窗已打开，**When** 用户点击关闭操作（关闭按钮或遮罩），**Then** 弹窗关闭且阅读页面状态保持不丢失。
4. **Given** 用户已使用统一设置弹窗，**When** 用户查看顶栏设置交互，**Then** 不再存在旧的二层“更多设置”展开区域。

---

### User Story 2 - 按分类配置阅读参数 (Priority: P2)

作为阅读器用户，我希望在“通用、滚动模式、书页模式、其他”分类里看到完整且不遗漏的现有配置项，并可即时修改，从而快速完成个性化设置。

**Why this priority**: 该需求明确要求“统一配置入口”且“参考已有设计不能遗漏”，直接决定功能完整性与可用性。

**Independent Test**: 打开弹窗后逐类核对配置项并逐项修改，验证变更立即生效且再次打开弹窗时显示当前值。

**Acceptance Scenarios**:

1. **Given** 用户进入“通用”分类，**When** 用户查看配置项，**Then** 可见并可配置语言、加载页数、自动换源重试。
2. **Given** 用户进入“滚动模式”分类，**When** 用户查看配置项，**Then** 可见并可配置页面比例、分卷页数、缩略图栏及现有滚动模式相关配置。
3. **Given** 用户进入“书页模式”分类，**When** 用户查看配置项，**Then** 可见并可配置同屏页数、阅读方向、翻页动效、页目录及现有书页模式相关配置。
4. **Given** 用户进入“其他”分类，**When** 用户点击清空缓存或 github 链接，**Then** 系统分别执行清空缓存与打开项目主页行为，并显示当前版本号。

---

### User Story 3 - 管理顶部快捷配置栏 (Priority: P3)

作为阅读器用户，我希望在“快捷设置”分类里选择顶部快捷配置栏展示项并调整顺序，以便高频配置可更快触达。

**Why this priority**: 快捷配置栏决定高频交互效率，但不阻断统一入口与基础分类配置，因此优先级低于前两者。

**Independent Test**: 在“快捷设置”中勾选/取消展示项并拖拽排序，切换阅读模式验证顶部快捷栏展示与顺序符合设置规则。

**Acceptance Scenarios**:

1. **Given** 用户进入“快捷设置”，**When** 用户查看快捷配置列表，**Then** “阅读模式”固定为第一位且不可取消、不可拖拽。
2. **Given** 用户已勾选多个非固定配置项，**When** 用户拖拽调整顺序，**Then** 顶部快捷配置栏按新顺序展示。
3. **Given** 用户处于滚动模式，**When** 顶部快捷配置栏渲染，**Then** 仅展示通用项与滚动模式适用项，不展示书页模式专属项。
4. **Given** 用户处于书页模式，**When** 顶部快捷配置栏渲染，**Then** 仅展示通用项与书页模式适用项，不展示滚动模式专属项。

### Edge Cases

- 当某分类下暂无可配置项或可见项很少时，左侧分类跳转仍应可用且右侧布局不出现空白错位。
- 当用户取消所有可选快捷项后，顶部快捷配置栏仍至少保留“阅读模式”这一固定项。
- 当用户尝试拖拽固定项“阅读模式”时，系统应阻止排序变更并保持其第一位。
- 当用户切换阅读模式时，模式专属快捷项应自动按规则显示/隐藏，不改变用户保存的全局排序与勾选状态。
- 当缓存清空执行中或失败时，系统应给出明确反馈，避免用户误认为操作已完成。
- 当用户执行“清空缓存”后，系统应确保配置恢复默认并在界面上立即反映。
- 当用户触发“清空缓存并重置全部设置”时，系统应先弹出确认提示并明确不可恢复影响。

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: 系统 MUST 在顶栏增加“更多设置”图标入口，图标风格与现有顶栏图标行为保持一致，并支持点击打开统一设置弹窗。
- **FR-002**: 系统 MUST 将统一设置页面以弹窗方式呈现，并提供明确的打开与关闭交互。
- **FR-003**: 系统 MUST 在弹窗中提供左右两列布局：左侧为分类导航，右侧为按分类分组的设置内容。
- **FR-004**: 系统 MUST 支持左侧分类导航快速滚动到右侧对应分组，且分类集合固定为：通用、滚动模式、书页模式、快捷设置、其他。
- **FR-004**: 系统 MUST 支持左侧分类导航通过平滑滚动定位到右侧对应分组，并高亮当前分类；不自动折叠其他分组；分类集合固定为：通用、滚动模式、书页模式、快捷设置、其他。
- **FR-005**: 系统 MUST 在“通用”分类中提供并支持修改以下配置：语言、加载页数、自动换源重试。
- **FR-006**: 系统 MUST 在“滚动模式”分类中提供并支持修改以下配置：页面比例、分卷页数、缩略图栏，以及当前产品已有的滚动模式相关配置项。
- **FR-007**: 系统 MUST 在“书页模式”分类中提供并支持修改以下配置：同屏页数、阅读方向、翻页动效、页目录，以及当前产品已有的书页模式相关配置项。
- **FR-008**: 系统 MUST 在“快捷设置”分类中提供顶部快捷配置栏的展示项管理能力。
- **FR-009**: 系统 MUST 将“阅读模式”作为顶部快捷配置栏固定项，且始终处于第一位，不允许取消展示或修改排序。
- **FR-010**: 用户 MUST be able to 对除固定项外的已选快捷配置项执行拖拽排序，排序结果应立即反映在顶部快捷配置栏。
- **FR-011**: 系统 MUST 根据当前阅读模式仅展示对应模式可用的模式专属快捷项；不适用模式的专属项不得显示在顶部快捷配置栏。
- **FR-012**: 系统 MUST 在“其他”分类中提供清空缓存、github 链接、版本号展示。
- **FR-013**: 系统 MUST 复用现有“清空缓存”与“github 链接”对应行为语义，确保功能结果与现有入口一致。
- **FR-014**: 系统 MUST 持久化用户在统一设置弹窗中的配置变更与快捷项排序，并在后续会话中恢复。
- **FR-014**: 系统 MUST 持久化用户在统一设置弹窗中的配置变更与快捷项排序，并在后续会话中恢复；快捷项排序使用全局唯一顺序。
- **FR-015**: 系统 MUST 确保统一设置弹窗覆盖现有设计中的可配置项，不因入口迁移导致任一已存在配置能力缺失。
- **FR-016**: 系统 MUST 提供简洁、美观、可读的弹窗视觉与排版，保证桌面与窄屏场景下均可完成配置操作。
- **FR-017**: 系统 MUST 移除原先顶栏二层“更多设置”展开交互，避免与统一设置弹窗形成重复入口或重复配置区域。
- **FR-018**: 系统 MUST 在用户执行“清空缓存”后同时重置全部用户配置（含统一设置与快捷配置偏好）为默认值。
- **FR-019**: 系统 MUST 在顶部快捷配置栏渲染时按“全局排序 + 当前模式过滤”规则展示配置项。
- **FR-020**: 系统 MUST 在执行“清空缓存并重置全部设置”前提供二次确认，并清晰提示该操作将恢复默认配置且不可撤销。

### Key Entities *(include if feature involves data)*

- **设置分类 (Settings Category)**: 统一设置弹窗中的一级分组，包含名称、显示顺序、可滚动定位目标。
- **配置项定义 (Setting Item Definition)**: 可配置能力的业务定义，包含归属分类、显示名称、当前值、可选值范围、适用阅读模式。
- **快捷配置项 (Quick Setting Item)**: 可展示在顶部快捷配置栏的配置项定义，包含是否固定、是否选中、显示顺序、模式适用范围。
- **快捷栏布局偏好 (Quick Bar Preference)**: 用户对快捷配置栏可见项与排序的持久化结果，包含固定项约束与上次保存时间。
- **快捷栏布局偏好 (Quick Bar Preference)**: 用户对快捷配置栏可见项与排序的持久化结果，包含全局唯一排序、固定项约束与上次保存时间。

### Assumptions

- 本功能聚焦统一设置入口与信息架构，不引入全新的阅读能力定义；优先整合和重排已有配置能力。
- “不遗漏”按当前产品已存在且对用户开放的全部可配置项定义，包含旧二层“更多设置”中的配置项。
- “自动换源重试”按用户描述视为通用配置，默认继承当前产品已有行为。
- “滚动模式/书页模式中的等项”以当前产品内已存在且可被用户配置的项为准，不将隐藏实验项自动暴露给普通用户。
- 快捷配置栏中的排序仅对用户可配置项生效，固定项规则优先级最高。
- 版本号展示使用当前运行版本信息，不新增独立版本维护流程。
- “清空缓存”包含重置全部用户配置，重置后默认值以产品当前默认配置为准。

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 至少 95% 的测试用户可在 5 秒内从顶栏找到并打开“更多设置”弹窗。
- **SC-002**: 在验收清单中，左侧 5 个分类的点击滚动定位成功率达到 100%。
- **SC-003**: 在配置完整性核对中，统一设置弹窗覆盖现有可配置能力的比例达到 100%，无缺失项。
- **SC-004**: 在快捷设置验收中，固定项约束、勾选展示、拖拽排序、模式专属显示规则一次性通过率达到 100%。
- **SC-005**: 至少 95% 的测试用户认为新弹窗“简洁且易于理解”（主观评分不低于 4/5）。
