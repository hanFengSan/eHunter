# Feature Specification: Thumb Expand Modal

**Feature Branch**: `[001-thumb-expand-modal]`  
**Created**: 2026-02-21  
**Status**: Draft  
**Input**: User description: "在ThumbScrollView底部(相当于当前屏幕底部)悬浮一个半透明的“展开”按钮。如果ThumbScrollView是横向展示的，则是最右侧。这个底部或则右侧，并不是指列表的底部，而是用户可视区域的底部或右侧。这个点击这个展开按钮后，会出发一个展示“全部缩略图”的弹窗。"

## Clarifications

### Session 2026-02-21

- Q: 整体 UI 风格参考哪一类现有界面样式？ → A: 参考设置类弹窗样式。

## User Scenarios & Testing *(mandatory)*

**Validation Note**: For each completed development cycle, run `npm run dev` and verify changed behavior in browser using `chrome-devtools-mcp` before marking work complete.

### User Story 1 - 快速展开全部缩略图 (Priority: P1)

作为阅读中的用户，我希望在当前可视区域边缘始终看到一个半透明“展开”入口，以便不滚动到列表末尾也能立即打开全部缩略图视图。

**Why this priority**: 这是进入“全部缩略图”能力的唯一入口，若入口不稳定或不可见，后续能力无法使用。

**Independent Test**: 在纵向与横向 ThumbScrollView 中分别滚动任意位置，验证入口始终固定在可视区域底部或右侧并可点击打开弹层。

**Acceptance Scenarios**:

1. **Given** ThumbScrollView 为纵向展示，**When** 用户在任意滚动位置查看页面，**Then** 半透明“展开”按钮固定在当前可视区域底部且不依赖列表内容末尾位置。
2. **Given** ThumbScrollView 为横向展示，**When** 用户在任意滚动位置查看页面，**Then** 半透明“展开”按钮固定在当前可视区域最右侧且可触发弹层。

---

### User Story 2 - 高密度浏览全部缩略图 (Priority: P2)

作为阅读中的用户，我希望弹层能一次显示高密度的缩略图网格和页码，减少翻页与滚动成本。

**Why this priority**: 该故事决定弹层是否真正提升定位效率，是功能价值的核心体验。

**Independent Test**: 打开弹层后，在常见桌面宽度与窄屏宽度下检查网格列数、行数与每项页码标注。

**Acceptance Scenarios**:

1. **Given** 设备宽度满足大屏布局条件，**When** 用户打开弹层，**Then** 每行最多显示 5 张缩略图，且首屏可见区域至少展示 4 行内容。
2. **Given** 设备宽度不满足大屏布局条件，**When** 用户打开弹层，**Then** 每行显示 3 张缩略图，且每项都包含对应页码编号。
3. **Given** 用户查看弹层内容，**When** 弹层渲染每个缩略图项，**Then** 每项包含图片本体与位于底边区域的页码编号。

---

### User Story 3 - 分页与跳转定位 (Priority: P3)

作为阅读中的用户，我希望通过分页快速定位到目标缩略图分段，并在点击缩略图后直接跳转到对应页且自动关闭弹层。

**Why this priority**: 该故事保障大页数内容下的可用性与闭环操作，但依赖前两个故事提供入口与展示。

**Independent Test**: 在超过 100 页的内容中使用分页切换区段并点击任一缩略图，验证跳转、关闭弹层和定位结果。

**Acceptance Scenarios**:

1. **Given** 弹层中存在超过 100 页缩略图，**When** 用户使用底部分页器切换页码分段，**Then** 缩略图按每 100 页一个分段更新展示。
2. **Given** 用户在弹层中点击任一缩略图，**When** 点击成功触发，**Then** 弹层自动关闭并将阅读视图跳转到该缩略图对应页码。

---

### Edge Cases

- 总页数少于或等于 100 时，分页器仍可见但仅显示一个可用分段。
- 当前分段最后一页不足一整行时，网格保持对齐，不显示错误页码或重复项。
- 当缩略图资源加载失败时，仍显示该项页码并允许用户点击跳转。
- 弹层打开后发生屏幕宽度变化（如旋转或窗口缩放）时，网格列数可在 5 列与 3 列规则间正确切换。
- 当当前阅读页不在当前分页分段时，弹层默认打开到包含当前阅读页的分段。

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: 系统必须在 ThumbScrollView 可视区域提供半透明“展开”浮动入口；纵向模式位于可视区域底部，横向模式位于可视区域右侧。
- **FR-002**: 用户点击“展开”入口后，系统必须打开一个不含标题的“全部缩略图”弹层。
- **FR-003**: 弹层中的每个缩略图项必须包含图片和对应页码编号，且页码显示在该项底边区域。
- **FR-004**: 弹层网格在宽屏条件下每行最多显示 5 项，在窄屏条件下每行显示 3 项。
- **FR-005**: 当弹层为 5 列布局时，弹层首屏可见区域必须至少容纳 4 行缩略图项，以保证信息密度。
- **FR-006**: 用户点击任意缩略图项后，系统必须自动关闭弹层并跳转到该项对应的阅读页。
- **FR-007**: 弹层底部必须提供分页导航，按每 100 页为一个分段浏览缩略图。
- **FR-008**: 弹层打开时，系统必须默认定位到包含当前阅读页的分页分段，并在该分段中突出当前阅读页对应项。
- **FR-009**: 当缩略图图片不可用时，系统必须显示可识别的占位状态并保留页码与跳转能力。
- **FR-010**: 弹层整体视觉风格（色彩层级、圆角、边框/阴影、间距与交互态）必须参考现有设置类弹窗风格，避免与现有界面产生明显风格割裂。

### Assumptions

- “设备宽度不够”默认指无法稳定容纳 5 列缩略图与必要间距时，自动降级为 3 列布局。
- 分页器在总页数不超过 100 时仍展示单页状态，保持交互一致性。
- “跳转到对应页码”以阅读器当前主阅读视图为目标，且跳转后焦点页即为用户点击项对应页。

### Dependencies

- 已存在可复用的 Pagination 交互能力，支持按页码分段导航。
- 阅读器已有“按页码跳转”能力，且可被缩略图点击动作调用。

### Scope Boundaries

- 本功能仅覆盖 ThumbScrollView 的“展开全部缩略图”入口与弹层浏览/跳转流程。
- 本功能不改变缩略图数据来源、抓取策略、缓存策略与图片清晰度策略。
- 本功能不引入新的用户权限模型或跨平台账号同步行为。
- 本功能在视觉规范上遵循现有设置类弹窗风格，不单独引入新视觉体系。

### Key Entities *(include if feature involves data)*

- **Expand Entry**: 浮动展开入口，关键属性包括展示位置（底部/右侧）、可见状态、可点击状态。
- **Thumbnail Item**: 全部缩略图中的单项，关键属性包括页码、缩略图展示状态、是否为当前阅读页。
- **Thumbnail Segment**: 按每 100 页划分的缩略图区段，关键属性包括分段编号、起止页码、当前选中状态。

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 在纵向与横向两种 ThumbScrollView 布局下，100% 验收样本均可在 1 次点击内打开“全部缩略图”弹层。
- **SC-002**: 在总页数 300 页以内的样本中，90% 用户可在 10 秒内通过弹层定位并跳转到目标页。
- **SC-003**: 在宽屏与窄屏验收中，网格列数规则（5 列/3 列）与“5 列至少 4 行可见”规则达到 100% 符合率。
- **SC-004**: 在验收场景中，点击缩略图后的“关闭弹层+跳转目标页”一次完成率达到 99% 及以上。
